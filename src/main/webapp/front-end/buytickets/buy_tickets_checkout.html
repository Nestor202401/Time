<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>立即購票</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
	crossorigin="anonymous">
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
	rel="stylesheet">
		<!-- icon link -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<style>
body {
	margin: 0;
	font-family: 'Poppins', sans-serif;
	color: #fff;
	background-color: #0c0c0c;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
}

main {
	flex: 1;
}

.footer {
	background-color: #1c1c1c;
	padding: 20px;
	text-align: center;
}

.footer .nav-links {
	margin-bottom: 10px;
}

.footer .nav-links a {
	margin: 0 15px;
	color: #fff;
	text-decoration: none;
	font-size: 14px;
}

.footer .nav-links a:hover {
	text-decoration: underline;
}

.footer .logo {
	display: block;
	margin: 0 auto 10px;
	max-width: 150px;
}

.footer .social-icons {
	margin: 10px 0;
}

.footer .social-icons a {
	margin: 0 10px;
	color: #fff;
	text-decoration: none;
	font-size: 20px;
}

.footer .social-icons a:hover {
	color: #ccc;
}

.footer .copyright {
	font-size: 12px;
	color: #ccc;
}

.footer .policy-links {
	margin-top: 10px;
}

.footer .policy-links a {
	margin: 0 5px;
	color: #ccc;
	text-decoration: none;
	font-size: 12px;
}

.footer .policy-links a:hover {
	text-decoration: underline;
}

header {
	background-color: #000;
	padding: 20px 0;
	width: 100%; /* Full width */
}

.container99 {
	width: 90%;
	max-width: 1200px;
	margin: 0 auto;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

nav ul {
	list-style: none;
	display: flex;
	gap: 30px; /* Increased gap between items */
	margin: 0;
	padding: 0;
}

nav ul li a {
	color: #fff;
	text-decoration: none;
	font-weight: 600;
	font-size: 18px; /* Increased font size */
	padding: 10px 15px; /* Added padding */
	transition: color 0.3s ease; /* Added transition for smooth effect */
}

nav ul li a:hover {
	color: #ffd700; /* Change text color on hover */
}

.auth-buttons99 button {
	background-color: #ffd700;
	border: none;
	padding: 10px 20px;
	cursor: pointer;
	font-size: 18px; /* Increased font size */
	border-radius: 5px;
	font-weight: 600;
	transition: background-color 0.3s ease;
	/* Added transition for smooth effect */
}

.auth-buttons button:hover {
	background-color: #e0c000; /* Change background color on hover */
}

.outer-container {
	display: flex;
	justify-content: center; /* 水平居中 */
	width: 100%; /* 讓外部容器占滿全寬 */
}

.container {
	width: 85%; /* 設置容器寬度 */
	overflow: auto; /* 清除浮動 */
	display: flex;
	justify-content: space-between; /* 子元素之間均勻分布 */
}

.box {
	padding: 20px; /* 內邊距 */
	border: 3.5px solid #6C6C6C; /* 邊框 */
	box-sizing: border-box; /* 盒子大小包含邊框 */
	color: black;
	font-size: 20px;
	border-top-left-radius: 15px; /* 左上角圓角 */
	border-top-right-radius: 15px; /* 右上角圓角 */
}

.box1 {
	width: 50%; /* 設置第一個盒子寬度 */
	background-color: lightblue; /* 背景色 */
}

.box2 {
	width: 35%; /* 設置第二個盒子寬度 */
	background-color: lightgreen; /* 背景色 */
}

.form-container {
	display: flex; /* 使用 flex 布局 */
	flex-direction: column; /* 设置子元素垂直排列 */
	min-height: 100%; /* 设置最小高度为 100% */
}

.section-container {
	display: flex; /* 使用 flex 布局 */
	flex-grow: 1; /* 子元素自动填充剩余空间 */
	gap: 0px; /* 设置左右两侧区块的间隔 */
}

.left-section {
	width: 65%; /* 左侧区块宽度为父容器的 50% */
	padding: 0px 80px 25px 80px; /* 设置内边距为 20px */
	margin: 0px;
}

.right-section {
	width: 100%; /* 右侧区块宽度为父容器的 50% */
	padding: 0px 150px; /* 设置内边距为 20px */
	margin: 0px;
}

.left-section-content {
	text-align: center; /* 设置文本居中显示 */
	background-color: #9D9D9D;
	border-radius: 15px; /* 设置四个角都有圆角 */
}

.right-section-content {
	text-align: center; /* 设置文本居中显示 */
	background-color: #9D9D9D; /* 背景色 */
	border-radius: 15px; /* 设置四个角都有圆角 */
}

button {
	padding: 10px 20px; /* 设置按钮的内边距 */
	background-color: #007bff; /* 设置背景色 */
	color: #fff; /* 设置文字颜色 */
	border: none; /* 移除边框 */
	cursor: pointer; /* 设置鼠标样式为手型 */
}

.button-container {
	text-align: right; /* 设置文本居中显示 */
	margin-top: auto; /* 将按钮容器置于页面底部 */
	padding: 20px; /* 添加上下内边距 */
}

.thstyle {
	font-size: 25px;
}

.thstyle2 {
	font-size: 20px;
	vertical-align: middle; /* 让文字垂直居中对齐 */
}

.input-style {
	font-size: 16px;
	padding: 5px;
}

.h1style {
	height: 65px;
	line-height: 65px;
	margin: 0;
	color: #000000;
}

.left-h1style2 {
	line-height: 120px;
	font-size: 1.5rem;
	width: 65%;
	text-align: center;
}

.right-h1style2 {
	line-height: 40px;
	font-size: 1.5rem;
	width: 35%;
	text-align: center;
}

.btn-lg {
	font-size: 1rem;
}

.tablestyle {
	width: 100%;
	border-bottom-left-radius: 15px;
	border-bottom-right-radius: 15px;
	background-color: #F0F0F0;
	overflow: hidden;
}
</style>
</head>
<body>
	<header>
		<div class="container99">
			<div class="logo">
				<h1>
					<a href="/Time/index.html" style="color: white; text-decoration: none;">Time影城</a>
				</h1>
			</div>
			<nav>
				<ul>
					<li><a href="/Time/front-end/movie/movie.html">電影</a></li>
					<li><a href="/Time/front-end/buytickets/buy_tickets_page.html">立即購票</a></li>
					<li><a href="#">周邊商品</a></li>
					<li><a href="/Time/front-end/article/home.jsp">討論區</a></li>
					<li><a href="#">會員中心</a></li>
								<li style="color:yellow; margin-top: 2px; margin-left: 30px;">  <i class="fas fa-user" style="margin-right: 5px;"></i></li>
					<li id="member" style="color:yellow; margin-top: 2px;  margin-left: -25px;">
    <span id="memberName"></span>
</li>
				</ul>
			</nav>
			<div class="auth-buttons99">
				<button style="color: black;">登入/註冊</button>
			</div>
		</div>
	</header>
	<main>
		<!-- ----------------------------------------------------------------- -->

		<div style="display: flex;">
			<div class="left-h1style2">
				<span id="movieName"> </span>
				<!-- 電影名稱 -->
			</div>
			<div class="right-h1style2">
				<span id="showDate"> </span>
				<!-- 日期 -->
				<span id="showTime"> </span><br>
				<!-- 時間 -->
				<span id="moviePlaybackType"> </span><br> <span
					id="seatNumbers"> </span>
			</div>
		</div>

		<form class="form-container">
			<div class="section-container">
				<!-- 	            <div class="left-section"> -->
				<!-- 	                <div class="left-section-content"> -->
				<!-- 	                    <h1 class="h1style">選擇電影票</h1> -->
				<!-- 	                    <table class="table tablestyle"> -->
				<!-- 						    <thead> -->
				<!-- 						        <tr> -->
				<!-- 							        <th scope="col" class="thstyle">票種</th> -->
				<!-- 							        <th scope="col" class="thstyle">價格</th> -->
				<!-- 							        <th scope="col" class="thstyle">數量</th> -->
				<!-- 						        </tr> -->
				<!-- 						    </thead> -->
				<!-- 						    <tbody id="ticketTable"> -->
				<!-- 							    顯示票種 -->
				<!-- 							</tbody> -->
				<!-- 						</table> -->
				<!-- 	                </div> -->
				<!-- 	            </div> -->
				<div class="right-section">
					<div class="right-section-content">
						<h1 class="h1style">購票清單</h1>
						<table class="table"
							style="width: 100%; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; background-color: #F0F0F0; overflow: hidden;">
							<thead>
								<tr>
									<th scope="col" class="thstyle">票種</th>
									<th scope="col" class="thstyle">數量</th>
									<th scope="col" class="thstyle">價格</th>
								</tr>
							</thead>
							<tbody id="selectedTicketsTable">
								<!-- 						    <tr> -->
								<!-- 						      <th class="thstyle2">一般票</th> -->
								<!-- 						      <th class="thstyle2">2</th> -->
								<!-- 						      <th class="thstyle2">640</th> -->
								<!-- 						    </tr> -->
								<!-- 						    <tr> -->
								<!-- 						      <th class="thstyle2">優待票</th> -->
								<!-- 						      <th class="thstyle2">1</th> -->
								<!-- 						      <th class="thstyle2">280</th> -->
								<!-- 						    </tr> -->
								<!-- 						    <tr> -->
								<!-- 						      <th class="thstyle2">敬老票</th> -->
								<!-- 						      <th class="thstyle2">1</th> -->
								<!-- 						      <th class="thstyle2">180</th> -->
								<!-- 						    </tr> -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="button-container">
				<input id="purchaseButton" class="btn btn-primary btn-lg"
					type="button" value="完成訂票"></input>
			</div>
		</form>
		<!-- ----------------------------------------------------------------- -->
	</main>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document)
				.ready(
						function() {
							// 發送AJAX請求到後端獲取存儲在Redis中的選擇數據
							$
									.ajax({
										url : "/Time/back-end/ticorder/TicketOrderServlet.do",
										type : "POST",
										data : {
											action : "getMemberData_Movie"
										},
										dataType : "json",
										success : function(data) {
											// 將獲取的數據顯示在指定的元素中
											$("#movieName")
													.text(data.movieName);
											$("#moviePlaybackType").text(
													data.moviePlaybackType);
											$("#showDate").text(
													data.showTimeDate);
											var showTimeText;
											switch (data.showTime) {
											case '0':
												showTimeText = "　6：00";
												break;
											case '1':
												showTimeText = "　12：00";
												break;
											case '2':
												showTimeText = "　18：00";
												break;
											}
											$("#showTime").text(showTimeText);
										},
										error : function(xhr) {
											console.log(xhr);
										}
									});

							// 發送AJAX請求到後端獲取存儲在Redis中的選擇數據
							$
									.ajax({
										url : "/Time/back-end/ticorder/TicketOrderServlet.do",
										type : "POST",
										data : {
											action : "getMemberData_SeatNumber"
										},
										dataType : "json",
										success : function(data) {
											// 將獲取的數據顯示在指定的元素中
											$("#seatNumbers").text(
													"座位：" + data.seatNumbers);
										},
										error : function(xhr) {
											console.log(xhr);
										}
									});

							$
									.ajax({
										url : "/Time/back-end/ticorder/TicketOrderServlet.do",
										type : "POST",
										data : {
											action : "getMemberData_Ticketlist"
										},
										dataType : "json",
										success : function(data) {
											// 將獲取的數據顯示在指定的元素中
											//             	console.log("aaaaaaaaaaaaaaa");
											var selectedTicketsTable = $("#selectedTicketsTable");
											selectedTicketsTable.empty();
											$
													.each(
															data.ticketSummary,
															function(index,
																	ticket) {
																var row = $("<tr></tr>");
																row
																		.append($(
																				"<th></th>")
																				.attr(
																						"id",
																						ticket.ticketTypeId)
																				.addClass(
																						"thstyle2")
																				.text(
																						ticket.ticketTypeName));
																row
																		.append($(
																				"<th></th>")
																				.attr(
																						"id",
																						ticket.ticketTypeId
																								+ "quantity")
																				.addClass(
																						"thstyle2")
																				.text(
																						ticket.quantity));
																row
																		.append($(
																				"<th></th>")
																				.addClass(
																						"thstyle2")
																				.text(
																						ticket.amount));
																selectedTicketsTable
																		.append(row);
															});
											// 如果需要顯示總金額，可以在這裡添加一行顯示
											var totalRow = $("<tr ></tr>")
													.attr("style",
															"background-color: #9D9D9D;border: 1px;");
											totalRow.append($("<th></th>")
													.addClass("thstyle2").text(
															"總金額"));
											totalRow
													.append($("<th></th>")
															.attr("id",
																	"totalQuantity")
															.attr("style",
																	"opacity: 0;")
															.addClass(
																	"thstyle2 ")
															.text(
																	data.totalAmount));
											totalRow.append($("<th></th>")
													.attr("id", "totalAmount")
													.addClass("thstyle2").text(
															data.totalAmount));
											selectedTicketsTable
													.append(totalRow);
										},
										error : function(xhr) {
											console.log(xhr);
										}
									});

							$("#purchaseButton")
									.on(
											"click",
											function() {
												var movieOrderTotal = $(
														"#totalAmount").text();
												$
														.ajax({
															url : "/Time/back-end/ticorder/TicketOrderServlet.do",
															type : "POST",
															data : {
																action : "addOrderData",
																movieOrderTotal : movieOrderTotal
															},
															success : function(
																	success) {
																if (confirm("訂單已成功添加! 點擊確定繼續。")) {
														            window.location.href = "/Time/index.html";
														        }
															},
															error : function(
																	xhr) {
																console
																		.log(xhr);
															}
														});
											});
						});
		
		function fetchMemberName() {
	        var xhr = new XMLHttpRequest();
	        var url = "/Time/getMemberName?timestamp=" + new Date().getTime(); // 添加時間戳來防止緩存
	        xhr.open("GET", url, true);
	        xhr.onreadystatechange = function() {
	            if (xhr.readyState === 4) {
	                if (xhr.status === 200) {
	                    var response = JSON.parse(xhr.responseText);
	                    var username = response.memberName;
	                    var memberElement = document.getElementById('member');
	                    if (username) {
	                        memberElement.textContent =username;
	                        document.querySelector('.auth-buttons99 button').textContent = "重新登入";
	                    } else {
	                        memberElement.textContent = "未登入會員";
	                    }
	                } else {
	                    console.error("Error fetching member name: " + xhr.status);
	                }
	            }
	        };
	        xhr.send();
	    }

	    // 當頁面加載時獲取會員名稱
	    window.onload = fetchMemberName;
	</script>



	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"
		integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/"
		crossorigin="anonymous"></script>

	<footer>
		<div class="footer">
			<div class="nav-links">
				<a href="#">工作機會</a> <a href="#">關於</a> <a href="#">客戶支援</a> <a
					href="#">聯繫我們</a> <a href="#">媒體報導</a> <a href="#">API</a>
			</div>
			<div class="social-icons">
				<a href="#"><i class="fab fa-twitter"></i></a> <a href="#"><i
					class="fab fa-facebook"></i></a> <a href="#"><i
					class="fab fa-reddit"></i></a> <a href="#"><i
					class="fab fa-instagram"></i></a> <a href="#"><i
					class="fab fa-youtube"></i></a>
			</div>
			<div class="copyright">© 2024 Time娛樂股份有限公司 (
				Entertainment,Inc.) 在此提及的所有 商標 是其各自所有人的財產。台灣商頁影城有限公司台灣分公司 28992446</div>
			<div class="policy-links">
				<a href="#">隱私</a> <a href="#">法律聲明</a> <a href="#">條款</a> <a
					href="#">Cookie 政策</a> <a href="#">Cookie 設定</a>
			</div>
		</div>
	</footer>

</body>
</html>